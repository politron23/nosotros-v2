<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Este Año Es Diferente</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body {
    background-color: #111827;
    color: #f3f4f6;
    font-family: 'Georgia', serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}

.container {
    background: #1f2937;
    padding: 50px;
    border-radius: 12px;
    box-shadow: 0 0 40px rgba(255,255,255,0.05);
    width: 600px;
    text-align: center;
}

h2 {
    margin-bottom: 20px;
    letter-spacing: 1px;
}

button {
    margin-top: 25px;
    padding: 12px 28px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 15px;
    transition: 0.3s;
    background-color: #e11d48;
    color: white;
}

button:hover {
    background-color: #be123c;
}

#processing {
    margin-top: 20px;
    font-style: italic;
    color: #d1d5db;
}
</style>
</head>

<body>

<div class="container">
    <h2>Este Año Es Diferente</h2>
    <p>Una carta escrita con honestidad y con todo mi Amooor.</p>
    <button onclick="startProcessing()">Ábrela Chamaquito</button>
    <div id="processing"></div>
</div>

<script>
function startProcessing() {
    const processingDiv = document.getElementById("processing");

    processingDiv.innerHTML = "En un día donde todos hablan de amor...";
    
    setTimeout(() => {
        processingDiv.innerHTML = "Yo quiero hablar con honestidad...";
    }, 1300);

    setTimeout(() => {
        processingDiv.innerHTML = "Porque este año es diferente...";
    }, 2600);

    setTimeout(() => {
        processingDiv.innerHTML = "";
        generatePDF();
    }, 4000);
}

async function generatePDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const pageWidth = doc.internal.pageSize.getWidth();
    const pageHeight = doc.internal.pageSize.getHeight();
    const margin = 30; // márgenes para la carta centrada
    const fecha = new Date().toLocaleDateString("es-MX");

    // Función para cargar la imagen
    function loadImage(url) {
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.crossOrigin = "Anonymous";
            img.onload = () => resolve(img);
            img.onerror = () => reject("No se pudo cargar la imagen");
            img.src = url;
        });
    }

    // Decorar cada página con fondo y bordes
    async function decoratePage() {
        // Fondo blanco
        doc.setFillColor(255,255,255);
        doc.rect(0,0,pageWidth,pageHeight,"F");

        // Intentar poner la imagen de fondo recortada
        try {
            const fondo = await loadImage("nosotros.jpg");

            const pageRatio = pageWidth / pageHeight;
            const imgRatio = fondo.width / fondo.height;

            let drawWidth, drawHeight, sx, sy, sw, sh;

            if (imgRatio > pageRatio) {
                // Imagen más ancha -> recortar lados
                drawHeight = fondo.height;
                drawWidth = drawHeight * pageRatio;
                sx = (fondo.width - drawWidth) / 2;
                sy = 0;
            } else {
                // Imagen más alta -> recortar arriba/abajo
                drawWidth = fondo.width;
                drawHeight = drawWidth / pageRatio;
                sx = 0;
                sy = (fondo.height - drawHeight) / 2;
            }

            // Dibujar en canvas con opacidad
            const canvas = document.createElement("canvas");
            canvas.width = drawWidth;
            canvas.height = drawHeight;
            const ctx = canvas.getContext("2d");
            ctx.globalAlpha = 0.10;
            ctx.drawImage(fondo, sx, sy, drawWidth, drawHeight, 0, 0, drawWidth, drawHeight);

            const imgData = canvas.toDataURL("image/jpeg");
            doc.addImage(imgData, "JPEG", 0, 0, pageWidth, pageHeight);

        } catch(e) {
            console.warn("No se cargó la imagen de fondo:", e);
        }

        // Bordes fijos
        doc.setDrawColor(100, 100, 100);
        doc.setLineWidth(1.2);
        doc.rect(15, 15, pageWidth - 30, pageHeight - 30);
    }

    await decoratePage();

    // Carta centrada verticalmente
    doc.setFont("helvetica", "bold");
    doc.setFontSize(18);
    doc.text("ESTE AÑO ES DIFERENTE", pageWidth / 2, 60, { align: "center" });

    doc.setFontSize(12);
    doc.setFont("helvetica", "italic");
    doc.text("San Valentín", pageWidth / 2, 70, { align: "center" });

    doc.setFont("helvetica", "normal");
    doc.setFontSize(11);

    const carta = `En un día como hoy, donde todos hablan de amor, yo quiero hablar con honestidad sobre lo nuestro.

Quiero decirte algunas cosas, y tal vez sea la última vez que te escriba algo así. Me he cansado de intentar sola y de sentir que no hay acciones de tu parte para recuperar lo nuestro. Mis ganas han sido muchas, pero el amor no funciona si no es mutuo.

Eres una persona demasiado importante para mí. Siempre creí que lo nuestro iba a funcionar, que íbamos a cumplir nuestras metas y construir nuestros sueños juntos. Sin embargo, parece que el destino tenía otro camino preparado para nosotros.

Quiero que sepas que eres el único hombre al que he amado de esta manera. Nunca quise perderte. Fuiste mi prioridad y muchas veces intenté demostrártelo. Si soy sincera, a veces quisiera regresar el tiempo a cuando solo éramos tú y yo.

Me hubiera gustado seguir aquí, pero siento que en tus planes ya no estoy yo como antes, y poco a poco he tenido que aceptarlo. Nunca supe exactamente cuándo nos empezamos a perder. Hubo muchas peleas, sí, pero también hubo muchas risas. Sabíamos arreglar nuestras diferencias, pero esta vez el orgullo nos ganó.

No me arrepiento de haberte conocido ni de haberte amado. Me enseñaste lo que es amar de verdad, y también entendí que amar implica saber soltar.

Hay algo que me dolió profundamente y que fue la razón por la que todo cambió para mí. Nunca imaginé que llegarías al punto de no querer convivir con mi familia, cuando ellos siempre te recibieron con respeto y cariño.

Y aunque seguimos hablando y todavía compartimos momentos, necesitaba escribir esto para poner en palabras lo que siento.

Aun así, una parte de mí siempre estará contigo, y una parte de ti siempre vivirá en mí.

Gracias por compartir una parte de tu vida conmigo.

Y si algún día entiendes todo lo que significó esto, sabrás dónde encontrarme.`;

    // Dividir texto en líneas y centrar verticalmente
    const lines = doc.splitTextToSize(carta, pageWidth - margin*2);
    const totalHeight = lines.length * 7 + 20; // +20 para nombre y fecha
    let y = (pageHeight - totalHeight) / 2 + 80; // +80 para título

    for (let line of lines) {
        if (y > pageHeight - 40) {
            doc.addPage();
            await decoratePage();
            y = 40;
        }
        doc.text(line, margin, y);
        y += 7;
    }

    y += 10;
    doc.setFont("helvetica", "bold");
    doc.text("Paola Sarai Politron Santillan", margin, y);

    y += 7;
    doc.setFont("helvetica", "normal");
    doc.text("Fecha: " + fecha, margin, y);

    doc.save("Este_Año_Es_Diferente.pdf");
}
</script>

</body>
</html>
